# 🏆 نظام المسابقة - تعليمات الإعداد

## 📋 الخطوات المطلوبة

### 1. إعداد قاعدة البيانات في Supabase

1. افتح [Supabase Dashboard](https://supabase.com/dashboard)
2. اذهب إلى **SQL Editor**
3. انسخ محتويات ملف `supabase_setup.sql` والصقها في المحرر
4. اضغط **Run** لتنفيذ الأوامر

سيقوم السكربت بإنشاء:
- ✅ جدول `admins` - لتخزين بيانات المشرفين
- ✅ جدول `admin_actions` - لتسجيل جميع الإجراءات
- ✅ جدول `rewards` - لتسجيل الجوائز
- ✅ سياسات الأمان (RLS Policies)
- ✅ Storage Bucket للصور (`avatars`)

### 2. إنشاء مستخدم إداري

1. في Supabase Dashboard، اذهب إلى **Authentication** → **Users**
2. اضغط **Add user** → **Create new user**
3. أدخل:
   - Email: البريد الإلكتروني للإدارة (مثل: `admin@example.com`)
   - Password: كلمة مرور قوية
4. احفظ البيانات - ستستخدمها لتسجيل الدخول

### 3. التأكد من Secrets

تأكد من أن Secrets التالية مضافة في Replit:
- ✅ `DATABASE_URL`
- ✅ `SUPABASE_URL`
- ✅ `SUPABASE_ANON_KEY`

### 4. تشغيل السكربت لإعداد المتغيرات

```bash
bash scripts/setup-env.sh
```

هذا السكربت سيقوم تلقائياً بإنشاء ملف `.env` في مجلد `client/` مع المتغيرات الصحيحة.

### 5. إعادة تشغيل التطبيق

بعد تنفيذ الخطوات السابقة، قم بإعادة تشغيل التطبيق.

---

## 🎯 استخدام النظام

### للزوار (عرض فقط)
- افتح الصفحة الرئيسية `/`
- يمكنك مشاهدة لوحة الترتيب والمنصة والجوائز
- لا يمكنك تعديل أي بيانات

### للإدارة (تعديل كامل)
1. اضغط زر **تسجيل الدخول** في أعلى الصفحة
2. أدخل بيانات المستخدم الإداري
3. بعد تسجيل الدخول، ستتمكن من:
   - ✅ إضافة مشرفين جدد
   - ✅ رفع صور للمشرفين
   - ✅ إضافة/خصم النقاط باستخدام الأزرار السريعة
   - ✅ تسجيل الحضور والتأخير والغيابات
   - ✅ إضافة نقاط للنشاط والترويج والتقارير

---

## 📊 نظام النقاط

### الحضور والالتزام
- ✅ **حضور كامل**: +10 نقاط
- ✅ **التزام بالوقت**: +5 نقاط
- ⏱ **تأخير بسيط** (أقل من 15 دقيقة): -2 نقاط
- ⏱ **تأخير متوسط** (15-60 دقيقة): -5 نقاط
- ⏱ **تأخير كبير** (أكثر من ساعة): -10 نقاط
- ❌ **غياب**: -15 نقاط

### النشاط والمشاركة
- 💬 **نشاط وتفاعل**: +5 نقاط
- 📑 **تقرير**: +10 نقاط
- 📢 **ترويج**: +15 نقاط
- 📅 **حضور اجتماع**: +10 نقاط

### الجوائز (كل 10 أيام)
- 🥇 **المركز الأول**: 30,000 نقطة + VIP 4 لمدة 5 أيام
- 🥈 **المركز الثاني**: 20,000 نقطة
- 🥉 **المركز الثالث**: 15,000 نقطة

⚠️ **ملاحظة**: الفائز لا يمكنه الترشح مرة أخرى إلا بعد مرور 20 يوم

---

## 🔧 استكشاف الأخطاء

### المشكلة: "Supabase credentials not found"
**الحل**: 
1. تأكد من إضافة `SUPABASE_URL` و `SUPABASE_ANON_KEY` في Secrets
2. قم بتشغيل `bash scripts/setup-env.sh`
3. أعد تشغيل التطبيق

### المشكلة: خطأ في رفع الصور
**الحل**:
1. تأكد من تنفيذ ملف `supabase_setup.sql` كاملاً
2. تحقق من أن Storage Bucket `avatars` موجود في Supabase
3. تأكد من أن السياسات (Policies) مفعلة

### المشكلة: لا يمكن تسجيل الدخول
**الحل**:
1. تأكد من إنشاء مستخدم في Supabase Authentication
2. تحقق من البريد الإلكتروني وكلمة المرور
3. تأكد من أن `SUPABASE_ANON_KEY` صحيحة

---

## 📝 ملاحظات مهمة

- ⚡ جميع التحديثات تتم فورياً
- 🔒 البيانات محمية بسياسات الأمان (RLS)
- 🖼️ الصور مخزنة بشكل آمن في Supabase Storage
- 📱 التصميم متجاوب ويعمل على جميع الأجهزة
- 🌙 يدعم الوضع الليلي (Dark Mode)
- 🇸🇦 واجهة عربية كاملة (RTL)

---

## 🆘 الدعم

إذا واجهت أي مشكلة، تأكد من:
1. ✅ تنفيذ جميع خطوات الإعداد
2. ✅ إعادة تشغيل التطبيق بعد كل تعديل
3. ✅ التحقق من سجلات الأخطاء في Supabase Dashboard
